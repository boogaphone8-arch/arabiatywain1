{% extends "base.html" %}
{% block content %}
  <section class="search-hero">
    <div class="search-hero-content">
      <h2 class="search-title">๐ ุงูุจุญุซ ุงูุฐูู ุนู ุงูุณูุงุฑุงุช</h2>
      <p class="search-subtitle">ุชูููุฉ ูุชูุฏูุฉ ููุจุญุซ ุงูููุฑู ุนู ุงูุณูุงุฑุงุช ุงููุณุฑููุฉ ุฃู ุงูููููุฏุฉ</p>
    </div>
  </section>

  <section class="card search-section">
    
    <form method="post" class="search-form">
      <div class="search-options">
        <label>ุงุจุญุซ ุจุงุณุชุฎุฏุงู:
          <select name="mode">
            <option value="plate" {% if mode=='plate' %}selected{% endif %}>ุฑูู ุงูููุญุฉ</option>
            <option value="chassis" {% if mode=='chassis' %}selected{% endif %}>ุฑูู ุงูุดุงุณู</option>
          </select>
        </label>
        
        <label>ุงููููุฉ
          <input name="value" placeholder="ุฃุฏุฎู ุฑูู ุงูููุญุฉ ุฃู ุงูุดุงุณู" value="{{ query_value or '' }}" required>
        </label>
      </div>
      
      <button type="submit" class="search-button">๐ ุจุญุซ</button>
    </form>
  </section>

  {% if status %}
    <section class="results-section">
      {% if status == 'matched' %}
        <div class="alert alert-warning">
          <h3>๐ฏ ุชุทุงุจู ููุฌูุฏ: ููุฌุฏ ุชุทุงุจู ุจูู ุจูุงุบ ููุฏุงู ูุจูุงุบ ุฑุตุฏ</h3>
          <p>ุชู ุงูุนุซูุฑ ุนูู ุชุทุงุจู ุจูู ุจูุงุบ ููุฏุงู ูุจูุงุบ ุฑุตุฏ ููุฐู ุงูุณูุงุฑุฉ. ููุชูุงุตู ุจูู ุงูุทุฑููู:</p>
          
          <div class="mediator-contact">
            <h4>๐ค ุชูุงุตู ูุน ุงููุณูุท ูุจุงุดุฑุฉ:</h4>
            <div class="contact-options">
              <a href="tel:{{ results[0].mediator_phone }}" class="contact-btn phone-btn">
                ๐ {{ results[0].mediator_phone }}
              </a>
              <a href="https://wa.me/{{ results[0].mediator_whatsapp.replace('+', '') }}" target="_blank" class="contact-btn whatsapp-btn">
                ๐ฌ ูุงุชุณุงุจ
              </a>
            </div>
            <p class="contact-note">
              <strong>ููุงุญุธุฉ:</strong> ุงููุณูุท ุณูููู ุจุชุณููู ุงูุชูุงุตู ุจูู ุงููุจูุบ ูุงูุฑุงุตุฏ ุจุดูู ุขูู ููุญูู.
            </p>
          </div>
        </div>
        
        <div class="matches-container">
          {% for row in results %}
            <div class="match-card">
              <div class="match-header">
                <span class="match-type">
                  {{ 'ุชุทุงุจู ุจุฑูู ุงูููุญุฉ' if row.rule=='plate' else 'ุชุทุงุจู ุจุฑูู ุงูุดุงุณู' }}
                </span>
              </div>
              
              <div class="match-details">
                <div class="report-side lost">
                  <h4>๐ ุจูุงุบ ุงูููุฏุงู</h4>
                  <div class="car-info">
                    <p><strong>ุงูุณูุงุฑุฉ:</strong> {{ row.lost.car_name }} 
                      {% if row.lost.model %}{{ row.lost.model }}{% endif %}
                      {% if row.lost.color %}- {{ row.lost.color }}{% endif %}
                    </p>
                    {% if row.lost.plate %}<p><strong>ุงูููุญุฉ:</strong> {{ row.lost.plate }}</p>{% endif %}
                    {% if row.lost.chassis %}<p><strong>ุงูุดุงุณู:</strong> {{ row.lost.chassis }}</p>{% endif %}
                    {% if row.lost.location %}<p><strong>ุงููููุน:</strong> {{ row.lost.location }}</p>{% endif %}
                    {% if row.lost.notes %}<p><strong>ููุงุญุธุงุช:</strong> {{ row.lost.notes }}</p>{% endif %}
                  </div>
                  {% if row.lost.image_path %}
                    <img src="{{ url_for('static', filename=row.lost.image_path) }}" alt="ุตูุฑุฉ ุงูุณูุงุฑุฉ ุงูููููุฏุฉ" class="car-image">
                  {% endif %}
                </div>
                
                <div class="vs-divider">โท</div>
                
                <div class="report-side sighting">
                  <h4>๐๏ธ ุจูุงุบ ุงูุฑุตุฏ</h4>
                  <div class="car-info">
                    <p><strong>ุงูุณูุงุฑุฉ:</strong> {{ row.sighting.car_name }} 
                      {% if row.sighting.model %}{{ row.sighting.model }}{% endif %}
                      {% if row.sighting.color %}- {{ row.sighting.color }}{% endif %}
                    </p>
                    {% if row.sighting.plate %}<p><strong>ุงูููุญุฉ:</strong> {{ row.sighting.plate }}</p>{% endif %}
                    {% if row.sighting.chassis %}<p><strong>ุงูุดุงุณู:</strong> {{ row.sighting.chassis }}</p>{% endif %}
                    {% if row.sighting.location %}<p><strong>ุงููููุน:</strong> {{ row.sighting.location }}</p>{% endif %}
                    {% if row.sighting.notes %}<p><strong>ููุงุญุธุงุช:</strong> {{ row.sighting.notes }}</p>{% endif %}
                  </div>
                  {% if row.sighting.image_path %}
                    <img src="{{ url_for('static', filename=row.sighting.image_path) }}" alt="ุตูุฑุฉ ุงูุณูุงุฑุฉ ุงููุฑุตูุฏุฉ" class="car-image">
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        
      {% elif status == 'raised' %}
        <div class="alert alert-danger">
          <h3>๐จ ุงูุณูุงุฑุฉ ูุฑููุนุฉ ุจุจูุงุบ ููุฏุงู</h3>
          <p>ูุฐู ุงูุณูุงุฑุฉ ูุณุฌูุฉ ูู ุงููุธุงู ูุณูุงุฑุฉ ููููุฏุฉ/ูุณุฑููุฉ.</p>
          
          <div class="action-buttons">
            <a href="{{ url_for('make_report', rtype='sighting') }}" class="button primary">
              ุณุฌูู ุจูุงุบ ุฑุตุฏ ุฅุฐุง ุฑุฃูุชูุง
            </a>
            <a href="{{ url_for('contact') }}" class="button secondary">
              ุชูุงุตู ูุน ุงููุณูุท
            </a>
          </div>
          
          <div class="warning-text">
            <p><strong>ุชุญุฐูุฑ:</strong> ุฅุฐุง ููุช ุชุญุงูู ุดุฑุงุก ูุฐู ุงูุณูุงุฑุฉุ ูููุตุญ ุจุดุฏุฉ ุนุฏู ุงููุชุงุจุนุฉ ูุงูุฅุจูุงุบ ุนู ุงููููุน ูููุณูุท.</p>
          </div>
        </div>
        
      {% else %}
        <div class="alert alert-success">
          <h3>โ ูุง ุชูุฌุฏ ุจูุงุบุงุช ูุทุงุจูุฉ ุญุงููุงู</h3>
          <p>ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ุจูุงุบุงุช ููุฏุงู ุฃู ุฑุตุฏ ูุทุงุจูุฉ ููุฐู ุงูุจูุงูุงุช ูู ุงูููุช ุงูุญุงูู.</p>
          
          <div class="suggestion-box">
            <p>ุชุฑูุฏ ุชุณุฌูู ุจูุงุบ ููุฐู ุงูุณูุงุฑุฉุ</p>
            <div class="action-buttons">
              <a href="{{ url_for('make_report', rtype='lost') }}" class="button">
                ุจูุงุบ ููุฏุงู
              </a>
              <a href="{{ url_for('make_report', rtype='sighting') }}" class="button">
                ุจูุงุบ ุฑุตุฏ
              </a>
            </div>
          </div>
        </div>
      {% endif %}
    </section>
  {% endif %}
{% endblock %}
