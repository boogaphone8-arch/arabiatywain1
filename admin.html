{% extends "base.html" %}
{% block content %}
  <section class="admin-hero">
    <div class="admin-hero-content">
      <h2 class="admin-title">โก ููุญุฉ ุชุญูู ุงููุณูุท ุงููุชูุฏูุฉ</h2>
      <p class="admin-subtitle">ุฅุฏุงุฑุฉ ุดุงููุฉ ููุจูุงุบุงุช ูุงูุชุทุงุจูุงุช ูุน ุฃุฏูุงุช ุงูุชูุงุตู ุงููุจุงุดุฑ</p>
      <div class="admin-actions">
        <a href="tel:+249928570921" class="admin-action-btn phone">๐ ุงุชุตุงู ูุจุงุดุฑ</a>
        <a href="https://wa.me/249928570921" target="_blank" class="admin-action-btn whatsapp">๐ฌ ูุงุชุณุงุจ</a>
        <a href="{{ url_for('search') }}" class="admin-action-btn search">๐ ุจุญุซ ุณุฑูุน</a>
        <a href="{{ url_for('bulk_import') }}" class="admin-action-btn bulk">๐ ุฑูุน ูุฌูุน</a>
      </div>
    </div>
  </section>

  <section class="card matches-section">
    <h3>๐ ุขุฎุฑ ุงูุชุทุงุจูุงุช (ุชุญุชุงุฌ ูุชุงุจุนุฉ)</h3>
    {% if matches %}
      <div class="matches-grid">
        {% for row in matches %}
          <div class="match-admin-card">
            <div class="match-header">
              <span class="match-type-badge">
                {{ 'ุชุทุงุจู ุจุงูููุญุฉ' if row.m.rule=='plate' else 'ุชุทุงุจู ุจุงูุดุงุณู' }}
              </span>
              <span class="match-date">{{ row.m.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
            </div>
            
            <div class="match-content">
              <div class="lost-section">
                <h4>๐ ุตุงุญุจ ุงูููุฏุงู</h4>
                <div class="car-details">
                  <p><strong>ุงูุณูุงุฑุฉ:</strong> {{ row.lost.car_name }} {{ row.lost.model or '' }} {{ row.lost.color or '' }}</p>
                  {% if row.lost.plate %}<p><strong>ุงูููุญุฉ:</strong> {{ row.lost.plate }}</p>{% endif %}
                  {% if row.lost.chassis %}<p><strong>ุงูุดุงุณู:</strong> {{ row.lost.chassis }}</p>{% endif %}
                  {% if row.lost.location %}<p><strong>ุงููููุน:</strong> {{ row.lost.location }}</p>{% endif %}
                </div>
                <div class="contact-info">
                  <p class="phone">๐ <strong>{{ row.lost.phone }}</strong></p>
                  <a href="tel:{{ row.lost.phone }}" class="contact-button">ุงุชุตุงู</a>
                  {% if row.lost.phone.startswith('+') %}
                    <a href="https://wa.me/{{ row.lost.phone[1:] }}" target="_blank" class="whatsapp-button">ูุงุชุณุงุจ</a>
                  {% endif %}
                </div>
                {% if row.lost.image_path %}
                  <img src="{{ url_for('static', filename=row.lost.image_path) }}" alt="ุตูุฑุฉ ุงูุณูุงุฑุฉ ุงูููููุฏุฉ" class="admin-car-image">
                {% endif %}
              </div>
              
              <div class="divider">โท</div>
              
              <div class="sighting-section">
                <h4>๐๏ธ ุตุงุญุจ ุงูุฑุตุฏ</h4>
                <div class="car-details">
                  <p><strong>ุงูุณูุงุฑุฉ:</strong> {{ row.sighting.car_name }} {{ row.sighting.model or '' }} {{ row.sighting.color or '' }}</p>
                  {% if row.sighting.plate %}<p><strong>ุงูููุญุฉ:</strong> {{ row.sighting.plate }}</p>{% endif %}
                  {% if row.sighting.chassis %}<p><strong>ุงูุดุงุณู:</strong> {{ row.sighting.chassis }}</p>{% endif %}
                  {% if row.sighting.location %}<p><strong>ุงููููุน:</strong> {{ row.sighting.location }}</p>{% endif %}
                </div>
                <div class="contact-info">
                  <p class="phone">๐ <strong>{{ row.sighting.phone }}</strong></p>
                  <a href="tel:{{ row.sighting.phone }}" class="contact-button">ุงุชุตุงู</a>
                  {% if row.sighting.phone.startswith('+') %}
                    <a href="https://wa.me/{{ row.sighting.phone[1:] }}" target="_blank" class="whatsapp-button">ูุงุชุณุงุจ</a>
                  {% endif %}
                </div>
                {% if row.sighting.image_path %}
                  <img src="{{ url_for('static', filename=row.sighting.image_path) }}" alt="ุตูุฑุฉ ุงูุณูุงุฑุฉ ุงููุฑุตูุฏุฉ" class="admin-car-image">
                {% endif %}
              </div>
            </div>
            
            {% if row.lost.notes or row.sighting.notes %}
              <div class="notes-section">
                {% if row.lost.notes %}
                  <p><strong>ููุงุญุธุงุช ุงูููุฏุงู:</strong> {{ row.lost.notes }}</p>
                {% endif %}
                {% if row.sighting.notes %}
                  <p><strong>ููุงุญุธุงุช ุงูุฑุตุฏ:</strong> {{ row.sighting.notes }}</p>
                {% endif %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="no-matches">
        <p class="muted">ูุง ุชูุฌุฏ ุชุทุงุจูุงุช ุจุนุฏ. ุณุชุธูุฑ ููุง ุนูุฏ ุญุฏูุซ ุชุทุงุจู ุจูู ุจูุงุบุงุช ุงูููุฏุงู ูุงูุฑุตุฏ.</p>
      </div>
    {% endif %}
  </section>

  <section class="card reports-section">
    <h3>๐ ุฃุญุฏุซ ุงูุจูุงุบุงุช</h3>
    {% if reports %}
      <div class="table-container">
        <table class="reports-table">
          <thead>
            <tr>
              <th>#</th>
              <th>ุงูููุน</th>
              <th>ุงูุณูุงุฑุฉ</th>
              <th>ุงูููุญุฉ</th>
              <th>ุงูุดุงุณู</th>
              <th>ุงููููุน</th>
              <th>ุงููุงุชู</th>
              <th>ุตูุฑุฉ</th>
              <th>ุงูุชุงุฑูุฎ</th>
              <th>ุญุงูุฉ</th>
            </tr>
          </thead>
          <tbody>
            {% for r in reports %}
              <tr class="report-row {{ r.report_type }}">
                <td>{{ r.id }}</td>
                <td>
                  <span class="report-type-badge {{ r.report_type }}">
                    {{ 'ููุฏุงู' if r.report_type=='lost' else 'ุฑุตุฏ' }}
                  </span>
                </td>
                <td>
                  <div class="car-summary">
                    <strong>{{ r.car_name }}</strong>
                    {% if r.model %}<br><small>{{ r.model }}</small>{% endif %}
                    {% if r.color %}<br><small>{{ r.color }}</small>{% endif %}
                  </div>
                </td>
                <td>{{ r.plate or '-' }}</td>
                <td>{{ r.chassis or '-' }}</td>
                <td>{{ r.location or '-' }}</td>
                <td>
                  <div class="phone-actions">
                    <span class="phone-number">{{ r.phone }}</span>
                    <div class="contact-actions">
                      <a href="tel:{{ r.phone }}" class="mini-button">๐</a>
                      {% if r.phone.startswith('+') %}
                        <a href="https://wa.me/{{ r.phone[1:] }}" target="_blank" class="mini-button">๐ฌ</a>
                      {% endif %}
                    </div>
                  </div>
                </td>
                <td>
                  {% if r.image_path %}
                    <img src="{{ url_for('static', filename=r.image_path) }}" alt="ุตูุฑุฉ ุงูุณูุงุฑุฉ" class="table-image">
                  {% else %}
                    <span class="no-image">-</span>
                  {% endif %}
                </td>
                <td>{{ r.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                  <span class="status-badge {{ 'active' if r.is_active else 'inactive' }}">
                    {{ 'ูุดุท' if r.is_active else 'ุบูุฑ ูุดุท' }}
                  </span>
                </td>
              </tr>
              {% if r.notes %}
                <tr class="notes-row">
                  <td colspan="10">
                    <small><strong>ููุงุญุธุงุช:</strong> {{ r.notes }}</small>
                  </td>
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="no-reports">
        <p class="muted">ูุง ุชูุฌุฏ ุจูุงุบุงุช ุจุนุฏ. ุณุชุธูุฑ ููุง ุนูุฏ ุชุณุฌูู ุฃูู ุจูุงุบ.</p>
      </div>
    {% endif %}
  </section>

  <section class="card stats-section">
    <h3>๐ ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ</h3>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number">{{ reports | selectattr('report_type', 'equalto', 'lost') | list | length }}</div>
        <div class="stat-label">ุจูุงุบุงุช ููุฏุงู</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ reports | selectattr('report_type', 'equalto', 'sighting') | list | length }}</div>
        <div class="stat-label">ุจูุงุบุงุช ุฑุตุฏ</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ matches | length }}</div>
        <div class="stat-label">ุชุทุงุจูุงุช</div>
      </div>
    </div>
  </section>
{% endblock %}
